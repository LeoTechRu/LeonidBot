{% extends "base.html" %}
{% block title %}Дашборд{% endblock %}

{% block content %}
  <div class="dashboard">

    {# — Профиль #}
    {% set profile_body %}
      <div class="grid grid-2 gap-md">
        <div><div class="text-muted">Full name</div><div>{{ profile_user.full_name or '—' }}</div></div>
        <div><div class="text-muted">Username</div><div>{{ profile_user.username }}</div></div>
        <div><div class="text-muted">Email</div><div>{{ profile_user.email or 'не указано' }}</div></div>
        <div><div class="text-muted">Телефон</div><div>{{ profile_user.phone or 'не указан' }}</div></div>
        <div><div class="text-muted">День рождения</div><div>{{ profile_user.birthday.strftime('%d.%m.%Y') if profile_user.birthday else 'не указано' }}</div></div>
        <div><div class="text-muted">Язык</div><div>{{ profile_user.language or 'не указан' }}</div></div>
        <div><div class="text-muted">Роль</div><div class="badge">{{ profile_user.role }}</div></div>
      </div>
    {% endset %}
    {% with title="Профиль", body=profile_body, classes="card--muted", span=2 %}
      {% include "widgets/_card.html" %}
    {% endwith %}

    {# — KPI ряд: примеры (могут прийти из контекста) #}
    {% with title="Фокус за неделю", label="Сфокусированные часы", value=kpi_hours or "0ч", delta=kpi_hours_delta or 0, classes="card--accent" %}
      {% include "widgets/_kpi.html" %}
    {% endwith %}
    {% with title="Достижения", label="Выполнено целей", value=kpi_goals or "0", delta=kpi_goals_delta or 0 %}
      {% include "widgets/_kpi.html" %}
    {% endwith %}
    {% with title="Здоровье", label="Health score", value=kpi_health or "—", delta=kpi_health_delta or 0 %}
      {% include "widgets/_kpi.html" %}
    {% endwith %}

    {# — Графики/плейсхолдеры #}
    {% with title="Активность по дням", span=2 %}
      {% include "widgets/_chart_placeholder.html" %}
    {% endwith %}
    {% with title="Сон / энергия" %}
      {% include "widgets/_chart_placeholder.html" %}
    {% endwith %}

    {# — Группы и проекты #}
    {% set groups_owned = owned_groups|map(attribute='title')|list %}
    {% set groups_items = groups_owned|map('string')|list %}
    {% with title="Руководите группами", items=owned_groups or [] %}
      {% include "widgets/_list.html" %}
    {% endwith %}

    {% with title="Состоите в группах", items=member_groups or [] %}
      {% include "widgets/_list.html" %}
    {% endwith %}
    {% with title="Ваши проекты", items=owned_projects or [] %}
      {% include "widgets/_list.html" %}
    {% endwith %}
    {% with title="Участвуете в проектах", items=member_projects or [] %}
      {% include "widgets/_list.html" %}
    {% endwith %}

    {# — Таймлайн дня #}
    {% with title="Сегодня", events=day_timeline or [] %}
      {% include "widgets/_timeline.html" %}
    {% endwith %}

  </div>
{% endblock %}
